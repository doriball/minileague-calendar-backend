name: Calendar Prod CI / CD Pipeline
on:
  push:
    branches:
      - main
    paths:
      - module-calendar/**
      - .github/workflows/prod-calendar-cicd.yml

jobs:
  CI-CD:
    runs-on: ubuntu-latest
    steps:
      - name: Full CI / CD Step
        uses: doriball/doriball-github-actions/.github/actions/backend/integration/backend-cicd@main
        with:
          env-name: prod
          service-name: minileague-calendar-api
          slack-webhook-url: ${{ secrets.SLACK_WEBHOOK_URL }}
          java-version: 21
          distribution: temurin
          working-directory: module-calendar
          build-command: ./gradlew :module-calendar:clean :module-calendar:bootJar
          docker-username: ${{ secrets.DOCKER_USERNAME }}
          docker-password: ${{ secrets.DOCKER_ACCESS_TOKEN }}
          docker-repository: mrcocoball/minileague-calendar-calendar-api
          tag-prefix: prod
          dockerfile-directory: module-calendar
          gitops-repository: git@github.com:doriball/minileague-calendar-infrastructure.git
          gitops-branch: main
          gitops-values-directory: environments/prod/apps/calendar-values.yml
          ssh-key: ${{ secrets.GITOPS_SSH_KEY }}
          commit-message: "chore: calendar prod image update"